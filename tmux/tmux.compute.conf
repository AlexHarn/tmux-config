# ==============================================
# ===   Compute node (L3) session overrides  ===
# ==============================================

# Launched via: ctmux (alias for TMUX_NEST_LEVEL=3 tmux)
# Status bar at bottom (same as L2, since L1 is at top)
set -g status-position bottom

# Level indicator
set -g @tmux_level "L3"

# L3 is the innermost level --- no nesting toggles needed.
# Unbind C-g so it passes through to L2 (which uses C-g to toggle L2<->L3).
# Unbind C-f so it passes through to L2, then to L1 (which uses C-f to toggle L1<->inner).
unbind -T root C-g
unbind -T off C-g
unbind -T root C-f
unbind -T off C-f

# Blue accent for L3 (distinguishes from L1/L2 orange)
color_main="colour39"

# Re-apply styles with new accent color
set -g mode-style "fg=default,bg=$color_main"
set -g message-style "fg=$color_main,bg=colour232"
setw -g window-status-current-style "fg=white,bold,bg=$color_main"

separator_powerline_right="î‚°"
setw -g window-status-current-format "#[fg=colour232,bg=$color_main]$separator_powerline_right#[fg=white] #I:#W #[fg=$color_main,bg=colour232]$separator_powerline_right#[default]"

setw -g pane-active-border-style "fg=$color_main"

# Minimal status bar for compute node
wg_is_zoomed="#[fg=colour232,bg=colour134]#{?window_zoomed_flag,[Z],}#[default]"
wg_is_keys_off="#[fg=white,bg=colour088]#([ $(tmux show-option -qv key-table) = '"'"'off'"'"' ] && echo '"'"'OFF'"'"')#[default]"
wg_user_host="#[fg=colour134]#(whoami)#[default]@#H"
wg_slurm="#[fg=colour220]#(~/.tmux/slurm_info.sh)#[default]"
wg_ultrawide="#[fg=colour134]#{?#{==:#{@ultrawide_mode},on},UW,}#[default]"

set -g status-left "#[fg=$color_main,bold] #{@tmux_level} #[default]"
set -g status-right "#{prefix_highlight} $wg_is_keys_off $wg_is_zoomed $wg_ultrawide | $wg_slurm #{sysstat_cpu} | #{sysstat_mem} | $wg_user_host"
